# Архитектура решений AETHA Fin - Документ принятых решений для AI-агентов и разработчиков

## Исполнительное резюме

Архитектура AETHA Fin построена на Next.js с Yandex.Cloud для обеспечения соответствия российскому законодательству. Приложение использует REST API, PostgreSQL для данных и YandexGPT для AI-анализа, обеспечивая безопасность и производительность финансовых операций.

## Инициализация проекта

Первой задачей будет установка шаблона:
```bash
git clone https://github.com/NextJSTemplates/openai-nextjs-starter.git aetha-fin
cd aetha-fin
npm install
```
Затем адаптация под YandexGPT вместо OpenAI.

## Решения

| Категория | Решение | Версия | Влияет на Epic | Обоснование |
|-----------|---------|--------|----------------|-------------|
| Фронтенд | Next.js | 14.x | Все UI-epic | SSR, TypeScript, производительность |
| База данных | Yandex Managed PostgreSQL | Latest | Epic 1,2,3,4 | Соответствие 152-ФЗ, ACID |
| AI-сервис | YandexGPT | Latest | Epic 2,3 | Локальная обработка, соответствие законам |
| API | REST | - | Все | Простота, надёжность |
| Развёртывание | Yandex Cloud Functions | - | Все | Serverless, масштабируемость |
| Платежи | Яндекс Пэй | - | Epic 2 | Российский рынок |
| Аутентификация | NextAuth.js + Yandex ID | - | Epic 1 | Безопасность, соответствие |

## Структура проекта

```
aetha-fin/
├── app/ (Next.js App Router)
├── components/ (React компоненты)
├── lib/ (утилиты, YandexGPT интеграция)
├── pages/api/ (REST API endpoints)
└── prisma/ (схема базы данных)
```

## Технологии

### Core Technologies

- Next.js 14
- TypeScript
- Tailwind CSS
- PostgreSQL (Yandex Managed)
- YandexGPT API

### Integration Points

- YandexGPT для AI-функций
- Yandex Pay для платежей
- Yandex ID для аутентификации

## Реализация паттернов

- API responses: {success: boolean, data: any, error: string}
- Error handling: Централизованная обработка с user-friendly сообщениями
- Logging: Winston с уровнями, сбор в Yandex Cloud Logging
- Authentication: JWT с MFA, Yandex ID интеграция

## Consistency Rules

### Naming Conventions

- API endpoints: /api/resource
- Компоненты: PascalCase
- Переменные: camelCase

### Code Organization

- Feature-based структура
- Shared utilities в /lib
- API routes в /pages/api

### Error Handling

Централизованная обработка ошибок с понятными сообщениями для пользователей.

### Logging Strategy

Структурированные логи с уровнями INFO/WARN/ERROR, без чувствительных данных.

## Data Architecture

Финансовые данные в PostgreSQL с шифрованием. Связи между пользователями, транзакциями, категориями.

## API Contracts

REST endpoints для:
- CRUD транзакций
- AI-анализ
- Симуляции
- Отчёты

## Security Architecture

- TLS 1.3 для всех соединений
- AES-256 для данных в покое
- MFA для пользователей
- Rate limiting

## Performance Considerations

- <3 сек для критических операций
- Кэширование в Redis
- Оптимизация запросов

## Deployment Architecture

Yandex Cloud Functions для serverless развертывания с автоматическим масштабированием.

## Development Environment

### Prerequisites

- Node.js 18+
- Git
- Yandex Cloud аккаунт

### Setup Commands

```bash
git clone https://github.com/NextJSTemplates/openai-nextjs-starter.git aetha-fin
cd aetha-fin
npm install
```

## Architecture Decision Records (ADRs)

1. **Выбор Yandex.Cloud:** Для соответствия российскому законодательству о данных
2. **YandexGPT вместо OpenAI:** Локальная обработка для безопасности
3. **REST API:** Простота и надёжность для финансовых данных
4. **Serverless deployment:** Масштабируемость и снижение costs

---

_Generated by BMAD Decision Architecture Workflow v1.0_
_Date: 2025-10-23_
_For: Рашит_
